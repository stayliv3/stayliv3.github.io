<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> strcmp绕过问题 · xd_xd's blog</title><meta name="description" content="strcmp绕过问题 - xd_xd"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><script src="/js/jquery-3.1.0.min.js"></script><script src="/js/jquery.goup.js"></script><script src="/js/goup.js"></script><link rel="search" type="application/opensearchdescription+xml" href="http://xdxd.love/atom.xml" title="xd_xd's blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/logo.jpg"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="https://github.com/hkalexling" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/archives" target="_self" class="nav-list-link">ARCHIVES</a></li><li class="nav-list-item"><a href="/friends" target="_self" class="nav-list-link">FRIENDS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">strcmp绕过问题</h1><div class="post-info">Nov 17, 2014</div><div class="post-content"><p>官方说明:</p>
<pre><code>Note a difference between <span class="number">5.2</span> <span class="keyword">and</span> <span class="number">5.3</span> versions

echo (int)strcmp(<span class="attribute">'pending</span>',<span class="keyword">array</span>());
will output -<span class="number">1</span> <span class="keyword">in</span> PHP <span class="number">5.2</span>.<span class="number">16</span> (probably <span class="keyword">in</span> <span class="keyword">all</span> versions prior <span class="number">5.3</span>)
but will output <span class="number">0</span> <span class="keyword">in</span> PHP <span class="number">5.3</span>.<span class="number">3</span>

<span class="keyword">Of</span> course, you never need <span class="keyword">to</span> <span class="keyword">use</span> <span class="keyword">array</span> as a parameter <span class="keyword">in</span> <span class="typename">string</span> comparisions.
</code></pre><p>说在5.3.3以后，当比较数组和字符串的时候，返回是0.而strcmp函数的输出含义如下:</p>
<pre><code>如果 str1 小于 str2 返回 &lt; <span class="number">0</span>； 如果 str1 大于 str2 返回 &gt; <span class="number">0</span>；如果两者相等，返回 <span class="number">0</span>。


&lt;?php
<span class="variable">$password</span>=$_GET[<span class="string">'password'</span>];

<span class="keyword">if</span>(strcmp(<span class="string">'xd'</span>,<span class="variable">$password</span>)){

    echo <span class="string">'NO!'</span>;

}<span class="keyword">else</span>{

    echo <span class="string">'YES!'</span>;

}
?&gt;
</code></pre><p>当php大于5.3.3以后，传入数组，果然进入了else分支。</p>
<p><img src="/images/strcmp1.jpg" alt="11"></p>
<p>对比php源码。图片来自于参考资料。<br><a href="https://github.com/php/php-src/commit/58a673a9094bd26453e2b910b87ae45800ecc88c#L11L326" target="_blank" rel="external">https://github.com/php/php-src/commit/58a673a9094bd26453e2b910b87ae45800ecc88c#L11L326</a><br><img src="/images/strcmp2.jpg" alt="11"><br><img src="/images/strcmp3.gif" alt="11"><br>不懂C，大体看下意思，php5.2中是将两个参数先转换成string类型。而5.5中如果参数不是string类型，直接return了。结果为null。而if条件中需要一个布尔类型的变量。null自动转换成布尔false，而strcmp比较两个字符串相同时，结果为int 0.0转换成布尔也是false。从而导致绕过。</p>
<p>#可能的应用场景</p>
<p>登录绕过。验证码绕过。。。。</p>
<p>#参考资料<br><a href="http://www.webhhh.net/web-security/PHP-strcpy.html" target="_blank" rel="external">http://www.webhhh.net/web-security/PHP-strcpy.html</a></p>
</div></article></div></section><footer><div class="paginator"><a href="/2014/11/25/discuz/" class="prev">上一篇</a><a href="/2014/10/31/mysqlfeature/" class="next">下一篇</a></div><div class="copyright"><p>© 2016 <a href="http://xdxd.love">xd_xd</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/hkalexling/Yuno-Apollo" target="_blank">Yuno-Apollo</a>.</p></div></footer></div><script src="https://cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>