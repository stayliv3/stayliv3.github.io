<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> MS15-034/CVE-2015-1635 测试记录 · xd_xd's blog</title><meta name="description" content="MS15-034/CVE-2015-1635 测试记录 - xd_xd"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://xdxd.love/atom.xml" title="xd_xd's blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/u/5256150165?is_all=1" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/stayliv3" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">MS15-034/CVE-2015-1635 测试记录</h1><div class="post-info">Apr 17, 2015</div><div class="post-content"><p>做协议测试的时候也发现不少溢出漏洞，没想iis还有这么经典的溢出案例。虽然不懂细节。记录一下测试过程。</p>
<p>#相关资料</p>
<p><a href="http://drops.wooyun.org/papers/5669" target="_blank" rel="external">http://drops.wooyun.org/papers/5669</a><br><a href="http://www.freebuf.com/articles/system/64185.html" target="_blank" rel="external">http://www.freebuf.com/articles/system/64185.html</a><br><a href="http://www.freebuf.com/vuls/64415.html" target="_blank" rel="external">http://www.freebuf.com/vuls/64415.html</a></p>
<p>#update</p>
<p>参考了阿里发的分析文章，修改poc为访问welcome.png图片，range下限改为2.可以百分百触发蓝屏。虽然不能RCE，看到蓝屏感觉也萌萌的。不过1337有RCE的exp卖，不知道是不是有更猥琐的姿势。</p>
<p>#测试记录</p>
<p>没有出现蓝屏。但是不打补丁返回确实不一样。测试环境 win7 32bit iis 7.5 。一开始测试的时候发现返回正常，后来发现是qq电脑管家自动打补丁了。。。删除补丁测试：</p>
<pre><code>[*] Audit Started
HTTP/1.1 416 Requested Range Not Satisfiable
Content-Type: text/html
Last-Modified: Fri, 17 Apr 2015 03:07:09 GMT
Accept-Ranges: bytes
ETag: "499ee897bb78d01:0"
Server: Microsoft-IIS/7.5
Date: Fri, 17 Apr 2015 07:09:31 GMT
Content-Length: 362
Content-Range: bytes */689

<span class="doctype">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN""http://www.w3.org/TR/html4/strict.dtd"&gt;</span>
<span class="tag">&lt;<span class="title">HTML</span>&gt;</span><span class="tag">&lt;<span class="title">HEAD</span>&gt;</span><span class="tag">&lt;<span class="title">TITLE</span>&gt;</span>Requested Range Not Satisfiable<span class="tag">&lt;/<span class="title">TITLE</span>&gt;</span>
<span class="tag">&lt;<span class="title">META</span> <span class="attribute">HTTP-EQUIV</span>=<span class="value">"Content-Type"</span> <span class="attribute">Content</span>=<span class="value">"text/html; charset=us-ascii"</span>&gt;</span><span class="tag">&lt;/<span class="title">HEAD</span>&gt;</span>
<span class="tag">&lt;<span class="title">BODY</span>&gt;</span><span class="tag">&lt;<span class="title">h2</span>&gt;</span>Requested Range Not Satisfiable<span class="tag">&lt;/<span class="title">h2</span>&gt;</span>
<span class="tag">&lt;<span class="title">hr</span>&gt;</span><span class="tag">&lt;<span class="title">p</span>&gt;</span>HTTP Error 416. The requested range is not satisfiable.<span class="tag">&lt;/<span class="title">p</span>&gt;</span>
<span class="tag">&lt;/<span class="title">BODY</span>&gt;</span><span class="tag">&lt;/<span class="title">HTML</span>&gt;</span>

[!!] Looks VULN
</code></pre><p>返回错误是The requested range is not satisfiable。</p>
<p>修改range的lower的值，socket会出错。但是没有出现蓝屏。蓝屏呢~~</p>
<p>打完补丁之后返回如下：</p>
<pre><code>[*] Audit Started
HTTP/1.1 400 Bad Request
Content-Type: text/html; charset=us-ascii
Server: Microsoft-HTTPAPI/2.0
Date: Fri, 17 Apr 2015 07:15:33 GMT
Connection: close
Content-Length: 339

<span class="doctype">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN""http://www.w3.org/TR/html4/strict.dtd"&gt;</span>
<span class="tag">&lt;<span class="title">HTML</span>&gt;</span><span class="tag">&lt;<span class="title">HEAD</span>&gt;</span><span class="tag">&lt;<span class="title">TITLE</span>&gt;</span>Bad Request<span class="tag">&lt;/<span class="title">TITLE</span>&gt;</span>
<span class="tag">&lt;<span class="title">META</span> <span class="attribute">HTTP-EQUIV</span>=<span class="value">"Content-Type"</span> <span class="attribute">Content</span>=<span class="value">"text/html; charset=us-ascii"</span>&gt;</span><span class="tag">&lt;/<span class="title">HEAD</span>&gt;</span>
<span class="tag">&lt;<span class="title">BODY</span>&gt;</span><span class="tag">&lt;<span class="title">h2</span>&gt;</span>Bad Request - Invalid Header<span class="tag">&lt;/<span class="title">h2</span>&gt;</span>
<span class="tag">&lt;<span class="title">hr</span>&gt;</span><span class="tag">&lt;<span class="title">p</span>&gt;</span>HTTP Error 400. The request has an invalid header name.<span class="tag">&lt;/<span class="title">p</span>&gt;</span>
<span class="tag">&lt;/<span class="title">BODY</span>&gt;</span><span class="tag">&lt;/<span class="title">HTML</span>&gt;</span>

[*] Looks Patched
</code></pre><p>相关<a href="https://github.com/stayliv3/blog_material/tree/master/ms15-034" target="_blank" rel="external">测试脚本</a>来自于网络。</p>
</div></article></div></section><footer><div class="paginator"><a href="/2015/04/17/失效的撞库防御策略之cookie/" class="prev">上一篇</a><a href="/2015/04/15/撞库攻击防御方案/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2016 <a href="http://xdxd.love">xd_xd</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>